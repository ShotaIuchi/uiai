# Output Format

検証結果の出力フォーマット定義。

## 基本構造

```markdown
## シナリオ検証結果

### {filename}

| ID | レベル | 行 | 内容 |
|----|--------|-----|------|
| {id} | {level} | {line} | {message} |

**エラー: {n}, 警告: {m}**

---

### サマリー

| ファイル | エラー | 警告 | ステータス |
|----------|--------|------|-----------|
| {file1} | 0 | 1 | WARN |
| {file2} | 2 | 0 | FAIL |

**合計: エラー {total_errors}, 警告 {total_warnings}**
```

## フィールド説明

| フィールド | 説明 |
|-----------|------|
| ID | ルールID（E001, W001 など） |
| レベル | ERROR または WARN |
| 行 | 問題のある行番号（範囲の場合は `8-12`） |
| 内容 | 問題の説明 |

## ステータス

| ステータス | 条件 |
|-----------|------|
| PASS | エラーなし、警告なし |
| WARN | エラーなし、警告あり |
| FAIL | エラーあり |

---

## 検証結果のみ出力（fix=false）

```markdown
## シナリオ検証結果

### login.yaml

| ID | レベル | 行 | 内容 |
|----|--------|-----|------|
| E005 | ERROR | 8 | `id` が指定されていません |
| E011 | ERROR | 15 | `id` が重複しています: "ログイン" |
| W002 | WARN | 8-12 | セクションに `then` がありません |

**エラー: 2, 警告: 1**

---

### checkout.yaml

| ID | レベル | 行 | 内容 |
|----|--------|-----|------|
| E020 | ERROR | 25 | `replay.from` の参照先 "初期化" が存在しません |

**エラー: 1, 警告: 0**

---

### サマリー

| ファイル | エラー | 警告 | ステータス |
|----------|--------|------|-----------|
| login.yaml | 2 | 1 | FAIL |
| checkout.yaml | 1 | 0 | FAIL |

**合計: エラー 3, 警告 1**
```

---

## 修正提案付き出力（fix=true dry-run=true）

```markdown
## シナリオ検証結果

### login.yaml

| ID | レベル | 行 | 内容 | 修正 |
|----|--------|-----|------|------|
| E005 | ERROR | 8 | `id` が指定されていません | 可 |
| E011 | ERROR | 15 | `id` が重複しています: "ログイン" | 可 |
| W002 | WARN | 8-12 | セクションに `then` がありません | - |

**エラー: 2, 警告: 1 (自動修正可能: 2)**

---

### 修正提案

#### E005: `id` が指定されていません (行 8)

**現在:**
```yaml
steps:
  - actions:
      - do: "アプリを起動"
```

**修正後:**
```yaml
steps:
  - id: "step_1"
    actions:
      - do: "アプリを起動"
```

#### E011: `id` が重複しています (行 15)

**現在:**
```yaml
  - id: "ログイン"
    actions:
      - do: "再ログイン"
```

**修正後:**
```yaml
  - id: "ログイン_2"
    actions:
      - do: "再ログイン"
```

---

### サマリー

| ファイル | エラー | 警告 | 修正可能 | ステータス |
|----------|--------|------|---------|-----------|
| login.yaml | 2 | 1 | 2 | FIXABLE |

**合計: エラー 2, 警告 1, 修正可能 2**

> ドライランモード: ファイルは変更されていません。
> 修正を適用するには `fix=true` を指定してください（dry-run を外す）。
```

---

## 修正実行後出力（fix=true）

```markdown
## シナリオ検証結果

### login.yaml

| ID | レベル | 行 | 内容 | 結果 |
|----|--------|-----|------|------|
| E005 | ERROR | 8 | `id` が指定されていません | 修正済 |
| E011 | ERROR | 15 | `id` が重複しています: "ログイン" | 修正済 |
| W002 | WARN | 8-12 | セクションに `then` がありません | - |

**修正済: 2, 残り警告: 1**

---

### 修正内容

#### E005 → `step_1` を追加
#### E011 → `ログイン` を `ログイン_2` に変更

---

### サマリー

| ファイル | 修正済 | 残りエラー | 残り警告 | ステータス |
|----------|--------|-----------|---------|-----------|
| login.yaml | 2 | 0 | 1 | FIXED (WARN) |

**修正済: 2, 残りエラー: 0, 残り警告: 1**
```

---

## エラーなし出力

```markdown
## シナリオ検証結果

### login.yaml

エラーなし

**エラー: 0, 警告: 0**

---

### サマリー

| ファイル | エラー | 警告 | ステータス |
|----------|--------|------|-----------|
| login.yaml | 0 | 0 | PASS |

**合計: エラー 0, 警告 0**

All scenarios are valid.
```

---

## 終了コード

| コード | 条件 |
|--------|------|
| 0 | エラーなし（strict=false: 警告のみもOK） |
| 1 | エラーあり、または strict=true で警告あり |
| 2 | ファイル読み込みエラー |

---

## メッセージテンプレート

| ID | メッセージ |
|----|-----------|
| E001 | `name` が指定されていません |
| E002 | `app` が指定されていません |
| E003 | `steps` が指定されていません |
| E004 | `steps` が空です |
| E005 | `id` が指定されていません |
| E006 | `actions` が指定されていません（replay もありません） |
| E010 | `app` の形式が不正です: "{value}" |
| E011 | `id` が重複しています: "{value}" |
| E012 | `do` と `then` が同一行に存在します |
| E013 | `wait` の値が数値ではありません: "{value}" |
| E014 | `strict` の値が boolean ではありません: "{value}" |
| E020 | `replay.from` の参照先 "{value}" が存在しません |
| E021 | `replay.to` の参照先 "{value}" が存在しません |
| E022 | `replay` の順序が不正です: "{from}" は "{to}" より後に定義されています |
| E023 | `replay` に循環参照があります: {cycle} |
| W001 | `actions` が空です |
| W002 | セクションに `then` がありません |
| W003 | `then` が連続しています（do なし） |
| W004 | `config` に未知のキーがあります: "{key}" |
